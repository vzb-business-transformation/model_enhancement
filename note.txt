(streamlit) SRIWOPE@XHK9JJM27Y model_enhancement % python -m enhance_predict_sequence
run_sql took 52.08 seconds to run.

=== Starting Circuit Prediction Enhancement Pipeline ===


=== STEP 1: Loading existing base model ===

Data processor loaded from results/models/data_processor.joblib

Loading saved models...
Loaded model 'voting_ensemble' from results/models/voting_ensemble_model.joblib
Loaded model 'stacked_ensemble' from results/models/stacked_ensemble_model.joblib
Loaded model 'xgb' from results/models/xgb_model.joblib
Loaded model 'rf' from results/models/rf_model.joblib
Loaded model 'lgb' from results/models/lgb_model.joblib
Loaded model 'gb' from results/models/gb_model.joblib
Loaded model 'cat' from results/models/cat_model.joblib
Loaded feature importances from results/models/feature_importances.joblib
Loaded model parameters from results/models/model_params.joblib
Base models loaded successfully

=== STEP 2: Predicting January disconnect durations ===

Loading January data...
run_sql took 4.13 seconds to run.
January active circuits: 1 records
Starting data preprocessing...
WARNING: Target column 'DISCO_DURATION' not found in initial dataframe
After distribution - Target column has 1 non-NaN values out of 1 rows
Engineering features...
Warning: Could not create distance buckets: Bin labels must be one fewer than the number of bin edges
Feature engineering complete. New shape: (1, 88)
After feature engineering - Target column NaN count: 0
Before one-hot encoding - Target column exists: True
  Target column type: int64
  Target column non-NaN values: 1
Categorical columns to encode: ['DOM_INTL_FLAG', 'INT_EXT_FLAG', 'REV_TYPE_FLAG', 'COST_TYPE_FLAG', 'FIRST_ADDR_TYPE_CODE', 'FIRST_ONNET', 'FIRST_INREGION', 'FIRST_XOLIT', 'ONNET_PROV', 'COMPANY_CODE', 'VRD_FLAG', 'OPCO_REV', 'IN_FOOTPRINT', 'NASP_TYPE', 'CIR_TECH_TYPE', 'CIR_BILL_TYPE', 'PROGRAM', 'BIZ_CASE', 'IEN_PROV', 'DISTANCE_BUCKET', 'SPEED_TIER', 'TECH_BILL_COMBO']
After one-hot encoding - Target column exists: True
  Target column non-NaN values: 1
Preprocessing complete. Final shape: (1, 58)
After distribution - Target column NaN count: 0
Final preprocessed data - Target column exists: True
  Target column non-NaN values: 1 out of 1 rows
Error predicting with voting_ensemble model: The feature names should match those that were passed during fit.
Feature names unseen at fit time:
- ACCESS_DISC
- ACCESS_DISC_RATE
- ACCESS_SPEED_SQUARED
- DISCONNECT_COMPLEXITY
- HAS_MULTIPLE_DISC
- ...
Feature names seen at fit time, yet now missing:
- ACCESS_SPEED_TIER_Medium
- CIR_TECH_TYPE_TDM
- COMPANY_CODE_XO
- COST_TYPE_FLAG_C
- COST_TYPE_FLAG_S
- ...

Error predicting with stacked_ensemble model: The feature names should match those that were passed during fit.
Feature names unseen at fit time:
- ACCESS_DISC
- ACCESS_DISC_RATE
- ACCESS_SPEED_SQUARED
- DISCONNECT_COMPLEXITY
- HAS_MULTIPLE_DISC
- ...
Feature names seen at fit time, yet now missing:
- ACCESS_SPEED_TIER_Medium
- CIR_TECH_TYPE_TDM
- COMPANY_CODE_XO
- COST_TYPE_FLAG_C
- COST_TYPE_FLAG_S
- ...

Error predicting with xgb model: feature_names mismatch: ['LVL_4_PRD_NM', 'VRTCL_MRKT_NAME', 'SALES_TIER', 'SR_CRCTP', 'RPTG_CRCTP', 'RPTG_CIR_SPEED', 'ACCESS_SPEED', 'PORT_SPEED', 'PVC_CAR_SPEED', 'MARGIN', 'FIRST_LAT', 'FIRST_LGNTD', 'PROD_YR_MTH', 'MONTH', 'VENDOR_COUNT', 'MONTH_SIN', 'MONTH_COS', 'CIRCUIT_AGE_DAYS', 'INST_MONTH', 'INST_DAY_OF_WEEK', 'ENDPOINT_DISTANCE_KM', 'SPEED_RATIO', 'SPEED_VARIATION', 'MAX_SPEED', 'TECH_ONNET_COMBO', 'MARKET_TIER_COMBO', 'MARGIN_SQUARED', 'LOG_MARGIN', 'LOG_ACCESS_SPEED', 'LOG_PORT_SPEED', 'REV_TYPE_FLAG_C ', 'COST_TYPE_FLAG_C ', 'COST_TYPE_FLAG_S ', 'COST_TYPE_FLAG_U ', 'FIRST_ADDR_TYPE_CODE_A', 'FIRST_ADDR_TYPE_CODE_SITE', 'FIRST_ONNET_Y ', 'FIRST_INREGION_OR', 'FIRST_XOLIT_Y ', 'COMPANY_CODE_XO', 'IN_FOOTPRINT_N ', 'IN_FOOTPRINT_Y ', 'CIR_TECH_TYPE_TDM', 'PROGRAM_NO ACTION', 'ACCESS_SPEED_TIER_Medium', 'PORT_SPEED_TIER_Medium'] ['LVL_4_PRD_NM', 'VRTCL_MRKT_NAME', 'SALES_TIER', 'SR_CRCTP', 'RPTG_CRCTP', 'RPTG_CIR_SPEED', 'ACCESS_SPEED', 'PORT_SPEED', 'PVC_CAR_SPEED', 'ACCESS_DISC', 'PORT_DISC', 'PVC_CAR_DISC', 'OTHER_DISC', 'OTHER_ADJ', 'MARGIN', 'FIRST_LAT', 'FIRST_LGNTD', 'PROD_YR_MTH', 'MONTH', 'YEAR', 'IS_QUARTER_END', 'IS_YEAR_END', 'VENDOR_COUNT', 'MONTH_SIN', 'MONTH_COS', 'CIRCUIT_AGE_DAYS', 'INST_MONTH', 'INST_QUARTER', 'INST_DAY_OF_WEEK', 'ENDPOINT_DISTANCE_KM', 'SPEED_RATIO', 'SPEED_VARIATION', 'MAX_SPEED', 'TOTAL_DISC', 'HAS_MULTIPLE_DISC', 'ACCESS_DISC_RATE', 'PORT_DISC_RATE', 'DISCONNECT_COMPLEXITY', 'MARGIN_SPEED_INTERACTION', 'MARGIN_DISCONNECT_RATIO', 'TECH_ONNET_COMBO', 'MARKET_TIER_COMBO', 'MARGIN_SQUARED', 'LOG_MARGIN', 'ACCESS_SPEED_SQUARED', 'LOG_ACCESS_SPEED', 'PORT_SPEED_SQUARED', 'LOG_PORT_SPEED', 'TOTAL_DISC_SQUARED', 'LOG_TOTAL_DISC']
expected ACCESS_SPEED_TIER_Medium, PROGRAM_NO ACTION, COMPANY_CODE_XO, FIRST_INREGION_OR, IN_FOOTPRINT_N , COST_TYPE_FLAG_C , FIRST_ONNET_Y , COST_TYPE_FLAG_S , IN_FOOTPRINT_Y , CIR_TECH_TYPE_TDM, FIRST_XOLIT_Y , FIRST_ADDR_TYPE_CODE_SITE, FIRST_ADDR_TYPE_CODE_A, PORT_SPEED_TIER_Medium, REV_TYPE_FLAG_C , COST_TYPE_FLAG_U  in input data
training data did not have the following fields: OTHER_ADJ, PORT_DISC_RATE, LOG_TOTAL_DISC, PVC_CAR_DISC, DISCONNECT_COMPLEXITY, MARGIN_SPEED_INTERACTION, PORT_DISC, YEAR, OTHER_DISC, PORT_SPEED_SQUARED, TOTAL_DISC_SQUARED, HAS_MULTIPLE_DISC, IS_QUARTER_END, IS_YEAR_END, ACCESS_DISC_RATE, ACCESS_SPEED_SQUARED, TOTAL_DISC, INST_QUARTER, ACCESS_DISC, MARGIN_DISCONNECT_RATIO
Error predicting with rf model: The feature names should match those that were passed during fit.
Feature names unseen at fit time:
- ACCESS_DISC
- ACCESS_DISC_RATE
- ACCESS_SPEED_SQUARED
- DISCONNECT_COMPLEXITY
- HAS_MULTIPLE_DISC
- ...
Feature names seen at fit time, yet now missing:
- ACCESS_SPEED_TIER_Medium
- CIR_TECH_TYPE_TDM
- COMPANY_CODE_XO
- COST_TYPE_FLAG_C
- COST_TYPE_FLAG_S
- ...

Error predicting with lgb model: Number of features of the model must match the input. Model n_features_ is 46 and input n_features is 50
Error predicting with gb model: The feature names should match those that were passed during fit.
Feature names unseen at fit time:
- ACCESS_DISC
- ACCESS_DISC_RATE
- ACCESS_SPEED_SQUARED
- DISCONNECT_COMPLEXITY
- HAS_MULTIPLE_DISC
- ...
Feature names seen at fit time, yet now missing:
- ACCESS_SPEED_TIER_Medium
- CIR_TECH_TYPE_TDM
- COMPANY_CODE_XO
- COST_TYPE_FLAG_C
- COST_TYPE_FLAG_S
- ...

Error predicting with cat model: /Users/zomb-ml-platform-msk/go-agent-21.2.0/pipelines/BuildMaster/catboost.git/catboost/libs/data/model_dataset_compatibility.cpp:81: At position 9 should be feature with name MARGIN (found ACCESS_DISC).
January predictions saved to results/january/january_predictions.csv

=== STEP 3: Analyzing January prediction errors ===

Note: To perform error analysis, we'll need to wait until actual disconnect
durations are available for the January circuits we're predicting.
When that data is available, rerun this step to enhance the model.

=== STEP 4: Predicting February disconnect durations ===

Loading February data...
run_sql took 3.58 seconds to run.
February active circuits: 1 records
Starting data preprocessing...
WARNING: Target column 'DISCO_DURATION' not found in initial dataframe
After distribution - Target column has 1 non-NaN values out of 1 rows
Engineering features...
Feature engineering complete. New shape: (1, 85)
After feature engineering - Target column NaN count: 0
Before one-hot encoding - Target column exists: True
  Target column type: int64
  Target column non-NaN values: 1
Categorical columns to encode: ['DOM_INTL_FLAG', 'INT_EXT_FLAG', 'REV_TYPE_FLAG', 'COST_TYPE_FLAG', 'FIRST_ADDR_TYPE_CODE', 'FIRST_ONNET', 'FIRST_INREGION', 'FIRST_XOLIT', 'ONNET_PROV', 'COMPANY_CODE', 'VRD_FLAG', 'OPCO_REV', 'IN_FOOTPRINT', 'NASP_TYPE', 'CIR_TECH_TYPE', 'CIR_BILL_TYPE', 'PROGRAM', 'BIZ_CASE', 'IEN_PROV', 'SPEED_TIER', 'TECH_BILL_COMBO']
After one-hot encoding - Target column exists: True
  Target column non-NaN values: 1
Preprocessing complete. Final shape: (1, 55)
After distribution - Target column NaN count: 0
Final preprocessed data - Target column exists: True
  Target column non-NaN values: 1 out of 1 rows
Error predicting with voting_ensemble model: The feature names should match those that were passed during fit.
Feature names unseen at fit time:
- ACCESS_DISC
- ACCESS_DISC_RATE
- ACCESS_SPEED_SQUARED
- DISCONNECT_COMPLEXITY
- HAS_MULTIPLE_DISC
- ...
Feature names seen at fit time, yet now missing:
- ACCESS_SPEED_TIER_Medium
- CIR_TECH_TYPE_TDM
- COMPANY_CODE_XO
- COST_TYPE_FLAG_C
- COST_TYPE_FLAG_S
- ...

Error predicting with stacked_ensemble model: The feature names should match those that were passed during fit.
Feature names unseen at fit time:
- ACCESS_DISC
- ACCESS_DISC_RATE
- ACCESS_SPEED_SQUARED
- DISCONNECT_COMPLEXITY
- HAS_MULTIPLE_DISC
- ...
Feature names seen at fit time, yet now missing:
- ACCESS_SPEED_TIER_Medium
- CIR_TECH_TYPE_TDM
- COMPANY_CODE_XO
- COST_TYPE_FLAG_C
- COST_TYPE_FLAG_S
- ...

Error predicting with xgb model: feature_names mismatch: ['LVL_4_PRD_NM', 'VRTCL_MRKT_NAME', 'SALES_TIER', 'SR_CRCTP', 'RPTG_CRCTP', 'RPTG_CIR_SPEED', 'ACCESS_SPEED', 'PORT_SPEED', 'PVC_CAR_SPEED', 'MARGIN', 'FIRST_LAT', 'FIRST_LGNTD', 'PROD_YR_MTH', 'MONTH', 'VENDOR_COUNT', 'MONTH_SIN', 'MONTH_COS', 'CIRCUIT_AGE_DAYS', 'INST_MONTH', 'INST_DAY_OF_WEEK', 'ENDPOINT_DISTANCE_KM', 'SPEED_RATIO', 'SPEED_VARIATION', 'MAX_SPEED', 'TECH_ONNET_COMBO', 'MARKET_TIER_COMBO', 'MARGIN_SQUARED', 'LOG_MARGIN', 'LOG_ACCESS_SPEED', 'LOG_PORT_SPEED', 'REV_TYPE_FLAG_C ', 'COST_TYPE_FLAG_C ', 'COST_TYPE_FLAG_S ', 'COST_TYPE_FLAG_U ', 'FIRST_ADDR_TYPE_CODE_A', 'FIRST_ADDR_TYPE_CODE_SITE', 'FIRST_ONNET_Y ', 'FIRST_INREGION_OR', 'FIRST_XOLIT_Y ', 'COMPANY_CODE_XO', 'IN_FOOTPRINT_N ', 'IN_FOOTPRINT_Y ', 'CIR_TECH_TYPE_TDM', 'PROGRAM_NO ACTION', 'ACCESS_SPEED_TIER_Medium', 'PORT_SPEED_TIER_Medium'] ['LVL_4_PRD_NM', 'VRTCL_MRKT_NAME', 'SALES_TIER', 'SR_CRCTP', 'RPTG_CRCTP', 'RPTG_CIR_SPEED', 'ACCESS_SPEED', 'PORT_SPEED', 'PVC_CAR_SPEED', 'ACCESS_DISC', 'PORT_DISC', 'PVC_CAR_DISC', 'OTHER_DISC', 'OTHER_ADJ', 'MARGIN', 'FIRST_LAT', 'FIRST_LGNTD', 'PROD_YR_MTH', 'MONTH', 'YEAR', 'IS_QUARTER_END', 'IS_YEAR_END', 'VENDOR_COUNT', 'MONTH_SIN', 'MONTH_COS', 'CIRCUIT_AGE_DAYS', 'INST_MONTH', 'INST_QUARTER', 'INST_DAY_OF_WEEK', 'SPEED_RATIO', 'SPEED_VARIATION', 'MAX_SPEED', 'TOTAL_DISC', 'HAS_MULTIPLE_DISC', 'DISCONNECT_COMPLEXITY', 'MARGIN_SPEED_INTERACTION', 'MARGIN_DISCONNECT_RATIO', 'TECH_ONNET_COMBO', 'MARKET_TIER_COMBO', 'MARGIN_SQUARED', 'LOG_MARGIN', 'ACCESS_SPEED_SQUARED', 'LOG_ACCESS_SPEED', 'PORT_SPEED_SQUARED', 'LOG_PORT_SPEED', 'TOTAL_DISC_SQUARED', 'LOG_TOTAL_DISC', 'SPEED_TIER_Medium', 'SPEED_TIER_High', 'SPEED_TIER_Ultra', 'SPEED_TIER_Unknown', 'ENDPOINT_DISTANCE_KM', 'ACCESS_DISC_RATE', 'PORT_DISC_RATE']
expected ACCESS_SPEED_TIER_Medium, PROGRAM_NO ACTION, COMPANY_CODE_XO, FIRST_INREGION_OR, IN_FOOTPRINT_N , COST_TYPE_FLAG_C , FIRST_ONNET_Y , COST_TYPE_FLAG_S , IN_FOOTPRINT_Y , CIR_TECH_TYPE_TDM, FIRST_XOLIT_Y , FIRST_ADDR_TYPE_CODE_SITE, FIRST_ADDR_TYPE_CODE_A, PORT_SPEED_TIER_Medium, REV_TYPE_FLAG_C , COST_TYPE_FLAG_U  in input data
training data did not have the following fields: OTHER_ADJ, PORT_DISC_RATE, SPEED_TIER_High, LOG_TOTAL_DISC, SPEED_TIER_Ultra, PVC_CAR_DISC, DISCONNECT_COMPLEXITY, MARGIN_SPEED_INTERACTION, PORT_DISC, YEAR, OTHER_DISC, PORT_SPEED_SQUARED, TOTAL_DISC_SQUARED, HAS_MULTIPLE_DISC, IS_QUARTER_END, IS_YEAR_END, ACCESS_SPEED_SQUARED, ACCESS_DISC_RATE, TOTAL_DISC, INST_QUARTER, SPEED_TIER_Medium, ACCESS_DISC, MARGIN_DISCONNECT_RATIO, SPEED_TIER_Unknown
Error predicting with rf model: The feature names should match those that were passed during fit.
Feature names unseen at fit time:
- ACCESS_DISC
- ACCESS_DISC_RATE
- ACCESS_SPEED_SQUARED
- DISCONNECT_COMPLEXITY
- HAS_MULTIPLE_DISC
- ...
Feature names seen at fit time, yet now missing:
- ACCESS_SPEED_TIER_Medium
- CIR_TECH_TYPE_TDM
- COMPANY_CODE_XO
- COST_TYPE_FLAG_C
- COST_TYPE_FLAG_S
- ...

Error predicting with lgb model: Number of features of the model must match the input. Model n_features_ is 46 and input n_features is 54
Error predicting with gb model: The feature names should match those that were passed during fit.
Feature names unseen at fit time:
- ACCESS_DISC
- ACCESS_DISC_RATE
- ACCESS_SPEED_SQUARED
- DISCONNECT_COMPLEXITY
- HAS_MULTIPLE_DISC
- ...
Feature names seen at fit time, yet now missing:
- ACCESS_SPEED_TIER_Medium
- CIR_TECH_TYPE_TDM
- COMPANY_CODE_XO
- COST_TYPE_FLAG_C
- COST_TYPE_FLAG_S
- ...

Error predicting with cat model: /Users/zomb-ml-platform-msk/go-agent-21.2.0/pipelines/BuildMaster/catboost.git/catboost/libs/data/model_dataset_compatibility.cpp:81: At position 9 should be feature with name MARGIN (found ACCESS_DISC).
February predictions saved to results/february_predictions.csv

=== STEP 5: Generating summary report ===

Summary report saved to results/prediction_summary_20250330_221605.txt

Prediction pipeline completed in 23.33 seconds
(streamlit) SRIWOPE@XHK9JJM27Y model_enhancement %
